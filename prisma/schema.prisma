// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Portfolio configuration
model Portfolio {
  id              String   @id @default(cuid())
  name            String
  type            String   // 'energy' | 'copper'
  initialValue    Float
  targetValue     Float
  borrowedAmount  Float
  marginCallLevel Float
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  theses          InvestmentThesis[]
  checklists      DailyChecklist[]
  stocks          Stock[]
  
  @@index([type])
}

// Stock holdings within a portfolio
model Stock {
  id              String   @id @default(cuid())
  portfolioId     String
  symbol          String
  name            String
  shares          Int
  avgPrice        Float
  currentPrice    Float?
  actualValue     Float?
  lastUpdated     DateTime @default(now())
  
  portfolio       Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  
  @@index([portfolioId])
  @@index([symbol])
}

// Investment thesis/decision framework
model InvestmentThesis {
  id              String   @id @default(cuid())
  portfolioId     String
  title           String
  description     String
  rationale       String   @db.Text
  risks           String[] // Array of risk factors
  indicators      String[] // Array of monitoring indicators
  targetPrice     Float?
  stopLoss        Float?
  timeHorizon     String   // 'short' | 'medium' | 'long'
  confidence      String   // 'low' | 'medium' | 'high'
  status          String   @default("active") // 'active' | 'review' | 'closed'
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  portfolio       Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  
  @@index([portfolioId])
  @@index([status])
}

// Daily checklist for monitoring
model DailyChecklist {
  id                    String   @id @default(cuid())
  portfolioId           String
  date                  DateTime @default(now())
  totalTasks            Int
  completedTasks        Int      @default(0)
  completionPercentage  Float    @default(0)
  currentStreak         Int      @default(0)
  longestStreak         Int      @default(0)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  portfolio             Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  tasks                 ChecklistTask[]
  
  @@index([portfolioId])
  @@index([date])
}

// Individual checklist task
model ChecklistTask {
  id              String   @id @default(cuid())
  checklistId     String
  portfolioId     String
  task            String
  category        String   // 'morning_routine' | 'market_hours' | 'evening_review' | 'event_driven'
  frequency       String   // 'Daily' | 'Weekly' | 'Monthly' | 'Ad-hoc'
  urgency         String   // 'green' | 'yellow' | 'red'
  completed       Boolean  @default(false)
  completedAt     DateTime?
  condition       String?  // Optional condition text
  dueDate         DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  checklist       DailyChecklist @relation(fields: [checklistId], references: [id], onDelete: Cascade)
  
  @@index([checklistId])
  @@index([portfolioId])
  @@index([category])
  @@index([completed])
}
