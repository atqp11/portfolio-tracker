generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Portfolio {
  id              String             @id @default(cuid())
  name            String
  type            String
  initialValue    Float
  targetValue     Float
  borrowedAmount  Float
  marginCallLevel Float
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  checklists      DailyChecklist[]
  theses          InvestmentThesis[]
  stocks          Stock[]

  @@index([type])
}

model Stock {
  id           String    @id @default(cuid())
  portfolioId  String
  symbol       String
  name         String
  shares       Int
  avgPrice     Float
  currentPrice Float?
  actualValue  Float?
  lastUpdated  DateTime  @default(now())
  portfolio    Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@index([portfolioId])
  @@index([symbol])
}

model InvestmentThesis {
  id          String    @id @default(cuid())
  portfolioId String
  title       String
  description String
  rationale   String
  risks       String[]
  indicators  String[]
  targetPrice Float?
  stopLoss    Float?
  timeHorizon String
  confidence  String
  status      String    @default("active")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  portfolio   Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@index([portfolioId])
  @@index([status])
}

model DailyChecklist {
  id                   String          @id @default(cuid())
  portfolioId          String
  date                 DateTime        @default(now())
  totalTasks           Int
  completedTasks       Int             @default(0)
  completionPercentage Float           @default(0)
  currentStreak        Int             @default(0)
  longestStreak        Int             @default(0)
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
  tasks                ChecklistTask[]
  portfolio            Portfolio       @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@index([portfolioId])
  @@index([date])
}

model ChecklistTask {
  id          String         @id @default(cuid())
  checklistId String
  portfolioId String
  task        String
  category    String
  frequency   String
  urgency     String
  completed   Boolean        @default(false)
  completedAt DateTime?
  condition   String?
  dueDate     DateTime?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  checklist   DailyChecklist @relation(fields: [checklistId], references: [id], onDelete: Cascade)

  @@index([checklistId])
  @@index([portfolioId])
  @@index([category])
  @@index([completed])
}
